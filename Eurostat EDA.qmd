---
title: "Eurostat EDA"
author: "Sindre H. Øveraas, Alen Colacovic & Sebastian M. Fløysand"
format: 
 pdf:
  papersize: a4
editor: visual
csl: apa-no-ampersand.csl
bibliography: [SHO.bib]
---

## Eurostat EDA

In this paper we are going to present an explanatory data analysis of different statistics of selected European countries.
We are more specifically going to analyze the European countries Austria (AT), Belgium (BE), Bulgaria (BG), Croatia (HR), Italy (IT), Serbia (RS), and Sweden (SE).

The paper will consist of four parts (assignments), where in the first part we will explore sub-national GDP and regional inequity in our selected countries.
For this part we will use data collected from Eurostat.
The data for the first part of the paper consists of GDP and population statistics for the years 2000 -- 2020, on a sub-regional level i.e., at NUTS 3 level.
NUTS (Nomenclature of territorial units for statistics) is the geographical nomenclature subdividing the economic territory of countries in the European Union.
These levels consist of NUTS 1, 2 and 3, with 3 representing the smallest territorial units in a country [@GlossaryNomenclatureTerritorial2021].
The remaining parts of this paper i.e., 2, 3 and 4, will be explained continuously and gradually when we eventually get to them later in the paper.

### Sub-National GDP

To start our analysis of sub-national GDP and regional inequity for our selected countries we must, as mentioned, collect data from Eurostat.
We download population by broad age group and sex, as well as gross domestic product at current markets prices, at NUTS 3 level [@StatisticsEurostat2022a] [@StatisticsEurostat2022].
After we have added our two datasets to our RStudio project, we can calculate GDP per capita at the NUTS 3 level for the separate countries.
This is achieved with dividing the GDP on the number of population figures, and can be presented with the following formula:\

$$
y_i=GDP_i/population_i
$$

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(vtable)
library(dineq)
library(dplyr)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(readr)
GDP <- read.csv('nama_10r_3gdp__custom_3564935_linear.csv')
Population <- read_csv("demo_r_pjanaggr3__custom_3579517_linear.csv")

gdpdata <- GDP %>%
  rename(Year = TIME_PERIOD, GDP = OBS_VALUE, Region = geo)

populationdata <- Population %>%
  rename(Year = TIME_PERIOD, Population = OBS_VALUE, Region = geo)

GDP_Per_Capita <- gdpdata %>%
  left_join(populationdata, by=c("Region", "Year")) %>%
  select(Region, Year, GDP, Population) %>%
  mutate(GDP_capita = (GDP * 1000000)/Population)
```

```{r, echo=FALSE}
kable(summary(GDP_Per_Capita[,3:5]))
```

Looking at the GDP per capita for all countries in the dataset, we find that the difference in population from min to max is big.
The difference between Median and Mean is also relatively big witch can indicate that some of the biggest regions has much larger amount of population then the rest and therefore affects the mean and pulls it higher.
The fact that the 3rd quartile is just a few thousands away from the mean amplifies our suspicion that we have some outliers with a very high population compared to the rest.

Its reason to believe that high population equals high GDP based on the fact that it is more people that contributes to the GDP.
However, this can not be applied in every circumstances.
For example Monaco with a population in 2020 of just above 39.000 [@MonacoPopulation2022] had a GDP on 6.25 billion USD the same year versus Burundi with a GDP on 3.22 billion [@GDPConstant2015] and a population just above 11.89 million [@BurundiPopulation2022].
The GDP per capita gives us a more accurate measure.
in the model above we can see that its a big difference in GDP per capita in each region, this can be caused by a population or a cluster with rich/poor individuals.

We also had some NA values witch we chose to take out of the dataset.
NA values may come from the fact that Population or the GDP was not measured this year or was not available when the dataset was made.

```{r, echo=FALSE}
GDP_Per_Capita$GDP_capita <- as.numeric(GDP_Per_Capita$GDP_capita)
GDP_Per_Capita$Population <- as.numeric(GDP_Per_Capita$Population)
```

```{r, echo=FALSE}
GDP_Per_Capita <- GDP_Per_Capita %>%  
  mutate(NUTS2 = substr(GDP_Per_Capita$Region,1,4))

GDP_Per_Capita <- GDP_Per_Capita %>%  
  mutate(NUTS = substr(GDP_Per_Capita$Region,1,2))

GDP_Per_Capita  %<>%
  group_by(NUTS2, Year) %>%
  na.exclude(GDP_Per_Capita) %>%
  mutate(GINI_NUTS2 = gini.wtd(GDP_capita, weights = Population)) %>%
  ungroup()
```

```{r, echo=FALSE}
GDP_Per_Capita %>% distinct(NUTS, Year, .keep_all = TRUE) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = NUTS)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

In the gg plot above we have taken out the countries that belongs to our selection - Austria (AT), Belgium (BE), Bulgaria (BG), Croatia (HR), Italy (IT), Serbia (RS) and Sweden (SE) - and added them in to a time series from year 2000 - 2020 (X-axis) to compare the evolution of GDP per capita (Y-axis) over the given time period.
The data is found and downloaded from Eurostat [@StatisticsEurostata]

Seven out of eight countries we where given was available for download trough Eurostat, the country witch we are missing is Bosnia and Herzegovina.

From the GG plot we can see that none of the countries have data from the whole time frame, some are missing data from the first years and others are missing from the last years.
Serbia only have data from around 2017 to 2019.
This might come from the fact that Serbia became an independent republic in 2006 and for that reason has not been collecting og establishing much info around GDP [@Serbia].

The country´s with the highest GDP per capita is Belgium and Sweden, where both countries has experienced growth in GDP per capita over time.
Sweden also has had the biggest growth in GDP Per capita compared to the other countries.

From the graphs, the three countries with highest GDP per capita had a noticeable decline around 2008, which is related to the financial crises at this time.
Sweden also experiences the largest dip around this time [@EconomicRecoveryEU]

Four of the five countris on the bottom also has experienced growth, just not as significant as Sweden and Belgium.
Austria had a big downfall in GDP per capita from year 2000 to 2001, but has had a stable growth since then.

### Bulgaria GDP

```{r, echo=FALSE}
GDP_Per_Capita_BG <- GDP_Per_Capita %>%
  filter(NUTS == "BG" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_BG$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "BG", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "BG", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### Belgium GDP

```{r, echo=FALSE}
GDP_Per_Capita_BE <- GDP_Per_Capita %>%
  filter(NUTS == "BE" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_BE$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "BE", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "BE", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### Austria GDP

```{r, echo=FALSE}
GDP_Per_Capita_AT <- GDP_Per_Capita %>%
  filter(NUTS == "AT" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_AT$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "AT", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "AT", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### Croatia GDP

```{r, echo=FALSE}
GDP_Per_Capita_HR <- GDP_Per_Capita %>%
  filter(NUTS == "HR" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_HR$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "HR", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "HR", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### Italy GDP

```{r, echo=FALSE, warning=FALSE}
GDP_Per_Capita_IT <- GDP_Per_Capita %>%
  filter(NUTS == "IT" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_IT$Region) %>%
  slice_max(GDP_capita, n = 500) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "IT", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "IT", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### Serbia GDP

```{r, echo=FALSE, warning=FALSE}
GDP_Per_Capita_RS <- GDP_Per_Capita %>%
  filter(NUTS == "RS" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_RS$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "RS", Year == 2017) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "RS", Year == 2017) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### Sweden GDP

```{r, echo=FALSE}
GDP_Per_Capita_SE <- GDP_Per_Capita %>%
  filter(NUTS == "SE" ) %>% select(GDP_capita, Region) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_SE$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "SE", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_max(GDP_capita, n = 3))
```

```{r, echo=FALSE}
kable(GDP_Per_Capita %>%
  filter(NUTS == "SE", Year == 2010) %>%
  select(Region, GDP_capita) %>%
  slice_min(GDP_capita, n = 3))
```

### 10 regions with highest GDP

```{r, echo=FALSE}
GDP_Per_Capita_Max <- GDP_Per_Capita %>%
  filter(Year == 2010) %>% select(GDP_capita, Region) %>%
  slice_max(GDP_capita, n = 10) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_Max$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

### 10 regions with lowest GDP

```{r, echo=FALSE}
GDP_Per_Capita_Min <- GDP_Per_Capita %>%
  filter(Year == 2010) %>% select(GDP_capita, Region) %>%
  slice_min(GDP_capita, n = 10) %>%
  select(Region)

GDP_Per_Capita %>%
  filter(Region %in% GDP_Per_Capita_Min$Region) %>%
  ggplot(aes(x = Year, y = GDP_capita, colour = Region)) + geom_line(lwd = .5) + labs(x = "Year", y = "GDP per capita") + theme_bw()
```

## Regional inequity

Regional inequity refers to skewed distribution and the differences in quality of life, wealth and general living standards among individuals in a region.
To determine regional inequity for our selected countries, we calculate the population-weighted GDP Gini coefficients ($GINIW_j$).
The coefficients can have values ranging from 0 to 1.
The value 0 corresponds to no inequity, and the higher the coefficient, the higher inequity appears in the respective country/ region.
The value 1 corresponds to absolute inequity.
The coefficients are calculated by the following formula:

$$
GINIW_j=\frac{1}{2 \bar{y_j}} \sum_{i}^{n_j}\sum_{l}^{n_j}\frac{p_i}{P_j} \frac{p_l}{P_j} |y_i-y_l|
$$

```{r, echo=FALSE}
kable(summary(GDP_Per_Capita[8]))
```

The summary statistics above give us the descriptive figures for all our selected countries combined, throughout the whole period of 2000 - 2020.
Based on the statistics, we can note that the lowest coefficient is equal to 0, meaning that there are some regions where inequality is absent.
We can also observe that the highest inequality throughout the entire period is 0.235.
The mean of the Gini coefficients are 0.071.

```{r, echo=FALSE}
kable(summary(GDP_Per_Capita %>%
  filter(Year == 2010) %>%
  select(GINI_NUTS2)))
```

```{r, echo=FALSE}
ggplot(data = GDP_Per_Capita) + geom_density(aes(x = GINI_NUTS2), fill = "maroon", col = "maroon", alpha = 0.2) + labs(x = "GINI", y = "Density") + theme_bw()
```

Density distribution of all coefficients in all selected countries.
We can observe that the density plot above matches our summary statistics of the coefficients.

```{r, echo=FALSE}
ggplot(data = GDP_Per_Capita, aes(x = NUTS, y = GINI_NUTS2)) + geom_point(color = "maroon", alpha = 0.25) + labs(x = "Country", y = "GINI") + theme_bw()
```

```{r, echo=FALSE}
GDP_Per_Capita %>%
  filter(NUTS == "SE") %>%
  distinct(NUTS2, Year, .keep_all = TRUE) %>%
  ggplot(aes(x = Year, y = GINI_NUTS2, fill = NUTS2, color = NUTS2)) + geom_point(lwd = 0.7) + labs(x = "Year", y = "GINI") + theme_bw()
```

```{r, echo=FALSE}
GDP_Per_Capita %>%
  filter(NUTS == "BE") %>%
  distinct(NUTS2, Year, .keep_all = TRUE) %>%
  ggplot(aes(x = Year, y = GINI_NUTS2, fill = NUTS2, color = NUTS2)) + geom_point(lwd = 0.7) + labs(x = "Year", y = "GINI") + theme_bw()
```

```{r, echo=FALSE}
GDP_Per_Capita %>%
  filter(NUTS == "BG") %>%
  distinct(NUTS2, Year, .keep_all = TRUE) %>%
  ggplot(aes(x = Year, y = GINI_NUTS2, fill = NUTS2, color = NUTS2)) + geom_point(lwd = 0.7) + labs(x = "Year", y = "GINI") + theme_bw()
```
